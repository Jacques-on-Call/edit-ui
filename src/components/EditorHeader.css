.editor-header {
  /* Height accounting for safe area on iOS */
  height: calc(var(--header-h) + env(safe-area-inset-top, 0));
  min-height: calc(var(--header-h) + env(safe-area-inset-top, 0));
  max-height: calc(var(--header-h) + env(safe-area-inset-top, 0));
  
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: env(safe-area-inset-top, 0) 12px 0 12px;
  background: rgba(2, 10, 30, 0.98);

  /* Fixed positioning for header - stays at top even when keyboard opens */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;

  box-sizing: border-box;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  width: 100%;

  /* GPU acceleration for smooth positioning - prevents repositioning on mobile */
  transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);

  /* Prevent repaints during scroll/keyboard - critical for mobile stability */
  will-change: transform;
  contain: layout style paint;

  /* Critical: prevent iOS from repositioning during keyboard events */
  -webkit-overflow-scrolling: auto;
  
  /* Allow dropdowns to escape the header's bounds */
  overflow: visible;
}

/* Header layout sections */
.editor-header .left { display: flex; align-items: center; gap: 12px; }
.editor-header .page-title { font-size: 1.25rem; margin: 0; color: #e6f0ff; }

.editor-header .center { display: flex; align-items: center; justify-content: center; flex: 1; }
.tabs .tab { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 6px 10px; margin: 0 6px; color: #cfe1ff; }
.tabs .tab.active { background: rgba(255,255,255,0.09); }

.right { display: flex; align-items: center; gap: 10px; }

/* Button styles */
.btn-icon { background: rgba(255,255,255,0.03); border: none; color: #cfe1ff; padding: 6px 8px; border-radius: 6px; font-size: 16px; }
.btn-primary { background: #1673ff; color: white; border-radius: 8px; padding: 8px 12px; border: none; }
.btn-plain { background: none; border: none; color: #cfe1ff; }

/* Ensure editor toolbar has proper visibility */
.editor-toolbar {
  color: #FFFFFF !important;
  z-index: 9999 !important;
}

/* Ensure dropdowns/menus can escape the header overflow */
.toolbar-group {
  position: relative;
  display: flex;
  align-items: center;
  gap: 2px;
}

/* Toolbar layout */
.toolbar {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Toolbar divider */
.toolbar-divider {
  width: 1px;
  height: 20px;
  background: rgba(255, 255, 255, 0.15);
  margin: 0 6px;
}

/* Toolbar button styles */
.toolbar button {
  margin: 0 2px;
  padding: 6px;
  border-radius: 4px;
  transition: background-color 0.2s ease-in-out;
  background: none;
  border: none;
  color: #cfe1ff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.toolbar button:hover:not(:disabled) {
  background-color: rgba(255, 255, 255, 0.1);
}
.toolbar button[data-active="true"] {
  background-color: rgba(255, 255, 255, 0.15);
  color: #a0deff; /* A light blue to indicate active state */
}
.toolbar button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Dropdown button content */
.dropdown-button-content {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Dropdown menu labels */
.dropdown-label {
  margin-left: 8px;
  font-size: 13px;
  white-space: nowrap;
}

/* Dropdown hint for disabled items (e.g., H1 already in use) */
.dropdown-hint {
  margin-left: auto;
  font-size: 11px;
  color: #888;
  font-style: italic;
}

/* Color indicator for color picker buttons */
.color-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.color-indicator-bar {
  width: 14px;
  height: 3px;
  border-radius: 1px;
}

/* Toolbar scroll container for mobile */
.toolbar-scroll-container {
  overflow-x: auto;
  overflow-y: hidden;
  white-space: nowrap;
  -webkit-overflow-scrolling: touch; /* for smooth scrolling on iOS */
  scrollbar-width: none; /* for Firefox */
}

.toolbar-scroll-container::-webkit-scrollbar {
  display: none; /* for Chrome, Safari, and Opera */
}

/* Mobile-specific fixes */
@media (max-width: 640px) {
  .editor-header .page-title { display: none; }
  .editor-header .page-title-mobile {
    font-size: 1rem;
    font-weight: 600;
    color: #e6f0ff;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }
  .tabs { display: none; }
  .toolbar-divider { margin: 0 4px; }
  .toolbar button { margin: 0 1px; padding: 5px; }
}

/* iOS Safari specific - ensure proper safe area handling */
@supports (-webkit-touch-callout: none) {
  .editor-header {
    /* iOS Safari: ensure header stays fixed and accounts for notch/safe area */
    position: fixed;
    top: 0;
  }
}

/* Touch devices - prevent keyboard displacement */
@media (hover: none) and (pointer: coarse) {
  .editor-header {
    /* On touch devices, maintain fixed positioning and GPU acceleration */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    transform: translate3d(0, 0, 0);
    -webkit-transform: translate3d(0, 0, 0);
  }
}

/* Ensure dropdowns appear above mobile keyboard */
@media (max-height: 500px) {
  /* When viewport is short (keyboard open), ensure dropdowns are accessible */
  .editor-header {
    z-index: 9999;
  }
}
