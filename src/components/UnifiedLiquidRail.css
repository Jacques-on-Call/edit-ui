:root {
  --rail-w: 44px; /* Blueprint: Set to ideal width */
  --rail-left: 12px;
  --rail-top: 16px;
  --rail-bg: rgba(20, 28, 38, 0.3); /* Blueprint: Strictly 30% opacity */
  --rail-blur: 18px; /* Blueprint: 18px blur */
  --rail-border: rgba(255, 255, 255, 0.1); /* Blueprint: 1px light border */
  --trigger-group-height: 88px; /* Blueprint: Exactly 88px (44px * 2) */
}

/* --- THE MICRO-CAPSULE TRIGGER --- */
.rail-trigger-group {
  position: fixed;
  top: var(--rail-top);
  left: var(--rail-left);
  width: var(--rail-w);
  height: var(--trigger-group-height);
  z-index: 10002;

  display: flex;
  flex-direction: column;

  background: var(--rail-bg);
  backdrop-filter: blur(var(--rail-blur));
  -webkit-backdrop-filter: blur(var(--rail-blur));
  border: 1px solid var(--rail-border);
  border-radius: 22px; /* Perfect pill shape for 44px width */

  transition: border-radius 200ms ease, border-color 200ms ease;
  overflow: hidden;
}

/* "Weld" Logic: Flatten bottom edge when rail is open */
.rail-trigger-group.is-open {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom-color: transparent;
}

/* Buttons are perfect squares */
.rail-btn {
  width: 100%;
  height: 50%; /* Each button is 44px high */
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  cursor: pointer;
  transition: all 200ms ease;
  position: relative;
}

.rail-btn:first-child {
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.rail-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}

.rail-btn.active {
  color: #fff;
  background: rgba(80, 150, 255, 0.2);
}

/* --- THE UNIFIED RAIL --- */
.unified-liquid-rail {
  position: fixed;
  top: calc(var(--rail-top) + var(--trigger-group-height));
  left: var(--rail-left);
  width: var(--rail-w); /* Blueprint: Rail stays same width */

  background: var(--rail-bg);
  backdrop-filter: blur(var(--rail-blur));
  -webkit-backdrop-filter: blur(var(--rail-blur));
  border: 1px solid var(--rail-border);
  border-top: none; /* Top border is handled by the capsule */

  opacity: 0;
  transform: translateY(-10px) translateZ(0);
  pointer-events: none;
  z-index: 10001;

  border-radius: 12px;
  display: flex;
  flex-direction: column;

  /* Mobile-first constraints */
  max-height: calc(100dvh - (var(--rail-top) + var(--trigger-group-height) + var(--action-bar-height, 64px) + var(--rail-top)));
  will-change: transform;

  transition: opacity 200ms ease, transform 200ms ease, width 200ms ease;
}

.unified-liquid-rail.open {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;

  /* "Weld" Logic: Flatten top edge to merge with trigger */
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

/* --- RAIL ITEMS --- */
.rail-item {
  display: flex;
  align-items: center;
  justify-content: center; /* Blueprint: Center the icon */
  width: 100%;
  height: 44px; /* Consistent height */
  padding: 0;
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  flex-shrink: 0;
  transition: all 150ms ease-in-out;
}

.rail-item:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}

.rail-item.active {
  color: #66aaff; /* A brighter blue for active state */
}

.rail-item-icon {
  flex-shrink: 0;
  margin: 0; /* Reset margin */
}

/* Blueprint: No Labels in compact mode */
.rail-item-label {
  display: none; /* Blueprint: No Labels, ever. */
}


/* --- SCROLL & KEYBOARD FIX --- */
.rail-scroll-area {
  padding: 8px 0;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  /* Blueprint: Keyboard Fix */
  max-height: calc(100dvh - 120px);
  overscroll-behavior: contain;
}

/* Hide scrollbar but keep functionality */
.rail-scroll-area::-webkit-scrollbar {
  width: 4px;
}
.rail-scroll-area::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
}
